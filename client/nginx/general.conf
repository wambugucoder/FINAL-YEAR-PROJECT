 # enable nginx metrics for the prometheus scraper
location /nginx_status {
            stub_status on;
            access_log  off;
            allow all;  # REPLACE with your access policy

 }
# restrict methods
 if ($request_method !~ ^(GET|POST|PUT|DELETE)$) {
        return '405';
    }

#Queueing with No Delay
location / {
    limit_req zone=mylimit burst=20 nodelay;
    index  index.html index.htm index.nginx-debian.html;

    #to redirect allrequests to index.html
    #useful when using react router
    try_files $uri $uri/ /index.html;
  }

  # redirect server error pages
error_page   500 502 503 504  /index.html;
location = / {
	root   /usr/share/nginx/html;
	internal;
}

  location ~* \.(?:manifest|appcache|html?|xml|json)$ {
            expires -1;
            # access_log logs/static.log; # I don't usually include a static log
        }


# Media: images, icons, video, audio, HTC
        location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ {
          expires 1M;
          access_log off;
          add_header Cache-Control "public";
        }

        location ~* \.(?:css|js)$ {
            try_files $uri =404;
            expires 1y;
            access_log off;
            add_header Cache-Control "public";
        }



  #setting up a reverse proxy for my backend
   location /api {

        proxy_pass https://backend;
       proxy_http_version                 1.1;
       proxy_cache_bypass                 $http_upgrade;
       # Proxy headers
       proxy_set_header Upgrade           $http_upgrade;
       proxy_set_header Connection        $connection_upgrade;
       proxy_set_header Host              $host;
       proxy_set_header X-Real-IP         $remote_addr;
       proxy_set_header Forwarded         $proxy_add_forwarded;
       proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       proxy_set_header X-Forwarded-Host  $host;
       proxy_set_header X-Forwarded-Port  $server_port;
       # Proxy timeouts
       proxy_connect_timeout              60s;
       proxy_send_timeout                 60s;
       proxy_read_timeout                 60s;


    }
